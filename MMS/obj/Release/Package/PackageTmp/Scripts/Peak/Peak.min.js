$.MMS.Peak=function(n,t){var r,i,u;sLoading();Vue.use(VTooltip);Vue.component("objetivo-info",{template:"#componentObjetivoInfo",props:{objetivo:{type:Object},readonly:{type:Boolean},tipo:{type:Number,"default":0}},methods:{removeInheritedReference:function(){this.objetivo.PeakObjetivoId=null}}});u=new Vue({el:"#peakContent",data:{tipo:t,tabId:1,completado:0,calificacion:0,numeroObjetivos:0,peak:{Id:0,Estado:0,FechaEnvio:""},peakTemp:{},objetivos:[],coreValues:[],planesDesarrollo:[],skills:[],periodo:{Id:0,Descripcion:"",FechaIni:"",RevisionFinalFechaIni:"",FechaFin:"",Estado:0,Actual:!1,RevisionFinal:!1},revisiones:[],usuario:{Id:0,Nombre:"",Cargo:"",Area:null,UsuarioPadre:null},areas:[],confirmacion:{areaId:null,cargo:null,usuarioPadre:null},cvRef:{},cvSeleccionado:{CoreValue:{}},planDesarrollo:{},objetivo:{Id:0,Numero:0,Peso:"",Heredable:!1,Objetivo:"",FechaMeta:"",MedidoPor:"",Estado:0,ComentariosRechazo:"",Completado:0,ResultadosActuales:"",Comentarios:"",MotivoModificacion:"",AprobacionModificacion:null,PeakObjetivoId:null,SolicitudEliminacionHeredado:null},aprobacion:{estado:1,comentariosRechazo:""},avance:{completado:0,resultadosActuales:"",comentarios:""},modificacion:{motivoModificacion:""},heredar:{objetivos:[]},revisionSeleccionada:{PeriodoRevision:{Id:0},Actual:!1,Comentarios:"",ComentariosJefe:"",Cerrada:!1},revision:{comentarios:"",comentariosJefe:""}},computed:{calificacionPorcentual:function(){return Math.round(100*this.calificacion/1.5)},estadoPeriodo:function(){switch(this.periodo.Estado){case-2:return"Not Started";case-1:return"Finished";case 1:return"Standby";case 2:return"Review";case 3:return"Final Review";default:return""}},estadoPeak:function(){switch(this.peak.Estado){case 0:return"Not Created";case 1:return"Objectives Definition";case 2:return"Objectives Approval";case 3:return"Standby";case 4:return"Review";case 5:return"Final Review";case 6:return"Finished";case 7:return"Objectives Modification Approval";case 8:return"Development Plan";default:return""}}},mounted:function(){var i=this;$.get(`/api/Peak/Get/${n}?tipo=${t}`).done(function(n){n.Peak.FechaEnvio&&(n.Peak.FechaEnvio=moment(n.Peak.FechaEnvio).format("YYYY-MM-DD HH:mm"));i.numeroObjetivos=n.NumeroObjetivos;i.peak=n.Peak;i.periodo=n.Periodo;i.usuario=n.Usuario;i.areas=n.Areas;i.revisiones=n.Revisiones;i.coreValues=n.CoreValues;i.skills=n.Skills;i.planesDesarrollo=n.PlanesDesarrollo;i.asignarObjetivos(n.Objetivos);i.recalcularCompletado();i.recalcularCalificacion();hLoading();$("#frmObjetivo [name=FechaMeta], #frmModificacionObjetivo [name=FechaMeta]").bootstrapMaterialDatePicker({format:"YYYY-MM-DD",weekStart:1,time:!1,minDate:i.periodo.FechaIni,maxDate:i.periodo.FechaFin}).change(function(){i.objetivo.FechaMeta=$(this).val();$(this).valid()});$("#frmPlanDesarrollo [name=FechaMeta]").bootstrapMaterialDatePicker({format:"YYYY-MM-DD",weekStart:1,time:!1}).change(function(){i.planDesarrollo.FechaMeta=$(this).val();$(this).valid()})}).fail(handleError)},watch:{},methods:{finishFinalReview:function(){var n=this,t=[],r=0,u;for(var i in n.objetivos)!n.objetivos[i].Calificacion!=null&&n.objetivos[i].ComentariosJefe||r++;r>0&&t.push("All Objectives must be rated.");r=0;for(i in n.coreValues)n.coreValues[i].Evaluacion||r++;if(r>0&&t.push("All Core Values must have Manager's Assessment."),n.peak.ComentariosCompetencias||t.push("Manager's Comments - Competencies required."),n.peak.ResumenContribucionesJefe&&n.peak.FortalezasJefe&&n.peak.ObjetivosFuturoJefe||t.push("Manager Feedback required."),n.peak.RendimientoGeneral||t.push("Overall Performance Rating required."),t.length>0){u="";for(i in t)u+=`<li>${t[i]}</li>`;msgAlert(`<ul>${u}</ul>`);return}swal({title:"Finish Final Review",text:"This Final Review will be finished.<br>After this action you will not be able to modify it.",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonText:"Finish Final Review"},function(){$.post(`/api/Peak/FinalizarRevisionFinal/${n.peak.Id}`).done(function(t){t?(n.peak.Estado=t.Estado,msgSuccess("Final Review Finished. Development Plan enabled")):msgError("Error finishing Final Review.")}).fail(handleError).always(function(){swal.close()})})},openReview:function(){var n=this;swal({title:"Open Review",text:"If you Open this Review, the Associate will be able to send this Review to you again.",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonText:"Open"},function(){$.post(`/api/Peak/AbrirRevision/${n.peak.Id}?periodoRevisionId=${n.revisionSeleccionada.PeriodoRevision.Id}`).done(function(t){t?(n.revisionSeleccionada.Cerrada=!1,msgSuccess("Review opened.")):msgError("Error opening the Review.")}).fail(handleError).always(function(){swal.close()})})},finish:function(){var n=this;if(n.planesDesarrollo.length==0){msgAlert("There must be at least one Development Plan");return}swal({title:"Finish Peak",text:"This Peak will be finished.<br>After this action you will not be able to modify it.",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonText:"Finish"},function(){$.post(`/api/Peak/Finalizar/${n.peak.Id}`).done(function(t){t?(n.peak.Estado=t.Estado,msgSuccess("Peak Finished.")):msgError("Error Finishing Peak.")}).fail(handleError).always(function(){swal.close()})})},eliminarPlanDesarrollo:function(n){var t=this;swal({title:"Delete Development Plan",text:"This Development will be deleted",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#f44336",confirmButtonText:"Delete"},function(){$.post(`/api/Peak/EliminarPlanDesarrollo/${t.planesDesarrollo[n].Id}`).done(function(i){i?(t.planesDesarrollo.splice(n,1),msgSuccess("Develpment Plan Removed.")):msgError("Error deleting Develpment Plan.")}).fail(handleError).always(function(){swal.close()})})},submitPlanDesarrollo:function(n){if($(n.target).valid()){var t=this;sLoading();$.post("/api/Peak/PlanDesarrollo/",$(n.target).serialize()).done(function(n){var i,r;if(n){if(t.planDesarrollo.Id==0)i=jQuery.extend(!0,{},t.planDesarrollo),i.Id=n.Id,t.planesDesarrollo.push(i);else for(r in t.planesDesarrollo)t.planesDesarrollo[r].Id==t.planDesarrollo.Id&&t.planesDesarrollo.splice(r,1,jQuery.extend(!0,{},t.planDesarrollo));msgSuccess("Development Plan Saved.");$("#frmPlanDesarrollo .modal").modal("hide")}else msgError("Error saving Development Plan.")}).fail(handleError).always(hLoading)}},modalPlanDesarrollo:function(n){var t=this;n==-1?(t.planDesarrollo.Id=0,t.planDesarrollo.Area="",t.planDesarrollo.Plan="",t.planDesarrollo.FechaMeta="",t.planDesarrollo.ResultadoDeseado=""):t.planDesarrollo=jQuery.extend(!0,{},t.planesDesarrollo[n]);t.modal("#frmPlanDesarrollo .modal",function(){$("#frmPlanDesarrollo").find("[name=Area]").focus()});$.MMS.validateForm("#frmPlanDesarrollo")},submitRendimientoGeneral:function(n){if($(n.target).valid()){var t=this;sLoading();$.post("/api/Peak/RendimientoGeneral/",$(n.target).serialize()).done(function(i){i?(t.peak.RendimientoGeneral=t.peakTemp.RendimientoGeneral,msgSuccess("Peak Saved."),$(n.target).find(".modal").modal("hide")):msgError("Error saving Peak.")}).fail(handleError).always(hLoading)}},modalRendimientoGeneral:function(){var n=this;n.peakTemp=jQuery.extend(!0,{},n.peak);n.modal("#frmRendimientoGeneral .modal",function(){$("#frmRendimientoGeneral").find("[name=RendimientoGeneral]").focus()});$.MMS.validateForm("#frmRendimientoGeneral")},submitFactorAjuste:function(n){if($(n.target).valid()){var t=this;sLoading();$.post("/api/Peak/FactorAjuste/",$(n.target).serialize()).done(function(i){i?(t.peak.FactorAjuste=i.FactorAjuste,t.peak.JustificacionFactorAjuste=t.peakTemp.JustificacionFactorAjuste,t.recalcularCalificacion(),msgSuccess("Peak Saved."),$(n.target).find(".modal").modal("hide")):msgError("Error saving Peak.")}).fail(handleError).always(hLoading)}},modalFactorAjuste:function(){var n=this;n.peakTemp=jQuery.extend(!0,{},n.peak);n.modal("#frmFactorAjuste .modal",function(){$("#frmFactorAjuste").find("[name=FactorAjuste]").focus()});$.MMS.validateForm("#frmFactorAjuste");setTimeout(function(){$("#frmFactorAjuste").find("[name=JustificacionFactorAjuste]").rules("add",{required:function(){var n=$("#frmFactorAjuste").find("[name=FactorAjuste]");return n.valid()?parseFloat(n.val().replace(",","."))>0:!1}})},150)},submitCalificacionObjetivo:function(n){if($(n.target).valid()){var t=this;sLoading();$.post("/api/Peak/CalificacionObjetivo/",$(n.target).serialize()).done(function(i){if(i){var r=t.objetivo.Numero-1;t.objetivos[r].Calificacion=i.Calificacion;t.objetivos[r].Factor=i.Factor;t.objetivos[r].ComentariosJefe=t.objetivo.ComentariosJefe;t.recalcularCalificacion();msgSuccess("Objective Saved.");$(n.target).find(".modal").modal("hide")}else msgError("Error saving Objective.")}).fail(handleError).always(hLoading)}},modalCalificacionObjetivo:function(n){var t=this;t.objetivo=jQuery.extend(!0,{},t.objetivos[n]);t.objetivo.Calificacion==null&&(t.objetivo.Calificacion=0,t.objetivo.Factor=0);t.modal("#frmCalificacionObjetivo .modal",function(){if(i)i.noUiSlider.set(t.objetivo.Calificacion);else{i=$("#nouislider_rating")[0];noUiSlider.create(i,{start:[t.objetivo.Calificacion],connect:"lower",step:.1,range:{min:[0],max:[1.5]}});i.noUiSlider.on("update",function(){var n=i.noUiSlider.get();t.objetivo.Calificacion=parseFloat(n);t.objetivo.Factor=t.objetivo.Calificacion*t.objetivo.Peso/100})}t.tipo!="manage"&&t.periodo.RevisionFinal&&(t.tipo!="review"||t.peak.Estado==5)?i.removeAttribute("disabled"):i.setAttribute("disabled",!0);$("#frmCalificacionObjetivo").find("[name=ComentariosJefe]").focus()});$.MMS.validateForm("#frmCalificacionObjetivo")},undoSendForFinalReview:function(){var n=this;swal({title:"Undo Send for Final Review",text:"The Final Review information will be able to modify it.",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0},function(){$.post(`/api/Peak/CancelarRevisionFinal/${n.peak.Id}`).done(function(t){t?(n.peak.Estado=t.Estado,msgSuccess("Undo done.")):msgError("Error undoing the action.")}).fail(handleError).always(function(){swal.close()})})},sendForFinalReview:function(){var n=this;for(var t in n.objetivos)if(n.objetivos[t].Estado!=2){msgAlert("All Objectives must be Approved");return}for(t in n.coreValues)if(!n.coreValues[t].Autoevaluacion){msgAlert("All Core Values must have Self Assessment.");return}swal({title:"Send for Final Review",text:"The Core Values and the Assessment will be sent for Final Review.",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonText:"Send"},function(){$.post(`/api/Peak/EnvioRevisionFinal/${n.peak.Id}`).done(function(t){t?(n.peak.Estado=t.Estado,msgSuccess("Peak Sent.")):msgError("Error Peak.")}).fail(handleError).always(function(){swal.close()})})},submitAutoevaluacion:function(n){if($(n.target).valid()){var t=this;sLoading();$.post("/api/Peak/AssesmentFeedback/",$(n.target).serialize()).done(function(i){i?(t.peak.ResumenContribuciones=t.peakTemp.ResumenContribuciones,t.peak.ResumenContribucionesJefe=t.peakTemp.ResumenContribucionesJefe,t.peak.Fortalezas=t.peakTemp.Fortalezas,t.peak.FortalezasJefe=t.peakTemp.FortalezasJefe,t.peak.ObjetivosFuturo=t.peakTemp.ObjetivosFuturo,t.peak.ObjetivosFuturoJefe=t.peakTemp.ObjetivosFuturoJefe,msgSuccess("Peak Saved."),$(n.target).find(".modal").modal("hide")):msgError("Error saving Peak.")}).fail(handleError).always(hLoading)}},modalAssessmentFeedback:function(n){var t=this;t.peakTemp=jQuery.extend(!0,{},t.peak);t.modal("#frmAutoevaluacion .modal",function(){$("#frmAutoevaluacion").find(`[name=${n}]`).focus()});$.MMS.validateForm("#frmAutoevaluacion")},submitCoreValuesComentarios:function(n){if($(n.target).valid()){var t=this;sLoading();$.post("/api/Peak/ComentariosCompetencias/",$(n.target).serialize()).done(function(i){i?(t.peak.ComentariosCompetencias=t.peakTemp.ComentariosCompetencias,msgSuccess("Peak Saved."),$(n.target).find(".modal").modal("hide")):msgError("Error saving Peak.")}).fail(handleError).always(hLoading)}},modalCoreValuesComments:function(){var n=this;n.peakTemp=jQuery.extend(!0,{},n.peak);n.modal("#frmCoreValuesComentarios .modal",function(){$("#frmCoreValuesComentarios").find("[name=ComentariosCompetencias]").focus()});$.MMS.validateForm("#frmCoreValuesComentarios")},submitCoreValue:function(n){if($(n.target).valid()){var t=this;sLoading();$.post("/api/Peak/"+(t.tipo=="manage"?"CoreValueAutoevaluacion":"CoreValueEvaluacion"),$(n.target).serialize()).done(function(i){i?(t.cvRef.Autoevaluacion=t.cvSeleccionado.Autoevaluacion,t.cvRef.Evaluacion=t.cvSeleccionado.Evaluacion,msgSuccess("Core Value Saved."),$(n.target).find(".modal").modal("hide")):msgError("Error saving Core Value.")}).fail(handleError).always(hLoading)}},modalCoreValue:function(n){var t=this;t.cvSeleccionado=jQuery.extend(!0,{},t.coreValues[n]);t.cvRef=t.coreValues[n];t.modal("#frmCoreValue .modal");$.MMS.validateForm("#frmCoreValue")},sendReviewResults:function(){var n=this,i=0,r,t;for(r in n.revisionSeleccionada.Objetivos)n.revisionSeleccionada.Objetivos[r].ComentariosJefe||i++;if(i>0){msgAlert("All Objectives must have Manager's Comments");return}t=function(t){sLoading();$.post(`/api/Peak/EnvioResultadoRevision/${n.peak.Id}?periodoRevisionId=${n.revisionSeleccionada.PeriodoRevision.Id}&cerrar=${t.toString()}`).done(function(i){if(i){n.peak.Estado=i.Estado;n.revisionSeleccionada.Cerrada=t;for(var r in n.revisionSeleccionada.Objetivos)n.revisionSeleccionada.Objetivos[r].TieneCambios=!1;msgSuccess("The Review Result were sent.")}else msgError("Error sending Review Result.")}).fail(handleError).always(hLoading)};swalExtend({swalFunction:function(){swal({title:"Send Review Result",text:"The Review Result will be send to the Associate.<br> If you Close this Review, the Associate will not be able to send this Review to you again.",type:"warning",html:!0,showCancelButton:!0,confirmButtonText:"Send and Close"},function(){t(!0)})},buttonNames:["Send"],clickFunctionList:[function(){t(!1)},]})},submitComentariosObjetivo:function(n){if($(n.target).valid()){var t=this;sLoading();$.post("/api/Peak/ComentariosObjetivoRevision/",$(n.target).serialize()).done(function(i){if(i){var r=t.objetivo.Numero-1;t.revisionSeleccionada.Objetivos[r].ComentariosJefe=t.objetivo.ComentariosJefe;msgSuccess("Objective Saved.");$(n.target).find(".modal").modal("hide")}else msgError("Error saving Objective.")}).fail(handleError).always(hLoading)}},modalComentariosObjetivo:function(n){var t=this;t.objetivo=jQuery.extend(!0,{},t.revisionSeleccionada.Objetivos[n]);t.modal("#frmComentariosObjetivo .modal",function(){$("#frmComentariosObjetivo").find("[name=ComentariosJefe]").focus()});$.MMS.validateForm("#frmComentariosObjetivo")},undoSendForReview:function(){var n=this;swal({title:"Undo Send for Review",text:"The Review Comments will be able to modify them.",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0},function(){$.post(`/api/Peak/CancelarRevision/${n.peak.Id}?periodoRevisionId=${n.revisionSeleccionada.PeriodoRevision.Id}`).done(function(t){t?(n.peak.Estado=t.Estado,msgSuccess("Undo done.")):msgError("Error undoing the action.")}).fail(handleError).always(function(){swal.close()})})},sendForReview:function(){var n=this,t=0,i=0;for(var r in n.objetivos)n.objetivos[r].Estado!=2&&t++,n.objetivos[r].ResultadosActuales||i++;if(t>0){msgAlert("All Objectives must be Approved");return}if(i>0){msgAlert("All Objectives must have Actual Results");return}swal({title:"Send for Review",text:"The Objetives and the Review Comments will be sent for Review.",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonText:"Send"},function(){$.post(`/api/Peak/EnvioRevision/${n.peak.Id}?periodoRevisionId=${n.revisionSeleccionada.PeriodoRevision.Id}`).done(function(t){t?(n.peak.Estado=t.Estado,n.revisionSeleccionada.Objetivos=t.Objetivos,msgSuccess("Review Sent.")):msgError("Error sending the Review.")}).fail(handleError).always(function(){swal.close()})})},submitComentariosRevision:function(n){if($(n.target).valid()){var t=this;sLoading();$.post("/api/Peak/ComentariosRevision/",$(n.target).serialize()).done(function(i){i?(t.revisionSeleccionada.Comentarios=t.revision.comentarios,t.revisionSeleccionada.ComentariosJefe=t.revision.comentariosJefe,t.revisionSeleccionada.FechaComentarios=i.FechaComentarios,t.revisionSeleccionada.FechaComentariosJefe=i.FechaComentariosJefe,msgSuccess("Review Comments Saved."),$(n.target).find(".modal").modal("hide")):msgError("Error saving Review Comments.")}).fail(handleError).always(hLoading)}},modalReviewComments:function(){var n=this;n.revision.comentarios=n.revisionSeleccionada.Comentarios;n.revision.comentariosJefe=n.revisionSeleccionada.ComentariosJefe;n.modal("#frmComentariosRevision .modal",function(){n.tipo=="manage"?$("#frmComentariosRevision").find("[name=Comentarios]").focus():$("#frmComentariosRevision").find("[name=ComentariosJefe]").focus()});$.MMS.validateForm("#frmComentariosRevision")},submitHeredar:function(){var n=this,i={},t=0;for(var r in n.heredar.objetivos)n.heredar.objetivos[r].Heredar&&(i[`[${t}].Value`]=n.heredar.objetivos[r].Id,t++);if(t==0){msgAlert("At least one Objective must be selected.");return}if(t+n.objetivos.length>n.numeroObjetivos){msgAlert(`Only ${n.numeroObjetivos-n.objetivos.length} Objetive(s) can be selected.`);return}sLoading();$.post("/api/Peak/HeredarObjetivos/"+n.peak.Id,$.param(i)).done(function(t){if(t){for(var i in t)t[i].FechaMeta=moment(t[i].FechaMeta).format("YYYY-MM-DD"),n.objetivos.push(t[i]);msgSuccess("Objectives Saved.");$("#modalHeredar").modal("hide")}else msgError("Error saving Objectives.")}).fail(handleError).always(hLoading)},modalHeredar:function(){var n=this;n.heredar.objetivos=[];$.get(`/api/Peak/HeredarObjetivos/${n.peak.Id}`).done(function(t){for(var i in t)t[i].FechaMeta=moment(t[i].FechaMeta).format("YYYY-MM-DD"),t[i].Heredar=!1;n.heredar.objetivos=t}).fail(handleError);n.modal("#modalHeredar")},sendModificationApprovalResults:function(){var n=this,t=0;for(var i in n.objetivos)n.objetivos[i].Estado==4&&n.objetivos[i].AprobacionModificacion==null&&t++;if(t>0){msgAlert("All modified Objectives must be Approved or Disapproved.");return}swal({title:"Send Modification Approval Results",text:"The Modification Approval Results will be send to the Associate",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonText:"Send"},function(){$.post("/api/Peak/EnvioResultadosModificacionAprobacion/"+n.peak.Id).done(function(t){t?(n.peak.Estado=t.Estado,n.asignarObjetivos(t.Objetivos),msgSuccess("The Modification Approval Results were sent.")):msgError("Error sending The Modification Approval Results.")}).fail(handleError).always(function(){swal.close()})})},submitAprobacionModificacionObjetivo:function(n){if($(n.target).valid()){var t=this;sLoading();$.post("/api/Peak/AprobacionModificacionObjetivo/",$(n.target).serialize()).done(function(i){if(i){var r=t.objetivo.Numero-1;t.objetivos[r].AprobacionModificacion=i.AprobacionModificacion;t.objetivos[r].ComentariosRechazo=i.AprobacionModificacion?null:t.aprobacion.comentariosRechazo;msgSuccess("Objective Saved.");$(n.target).find(".modal").modal("hide")}else msgError("Error saving Objective.")}).fail(handleError).always(hLoading)}},modalAprobacionModificationObjetivo:function(n){var t=this;t.objetivo=jQuery.extend(!0,{},t.objetivos[n]);t.aprobacion.estado=t.objetivo.AprobacionModificacion==null?1:t.objetivo.AprobacionModificacion?2:3;t.aprobacion.comentariosRechazo=t.objetivo.ComentariosRechazo;t.modal("#frmAprobacionModificacionObjetivo .modal",function(){$("#frmAprobacionModificacionObjetivo").find("[name=ComentariosRechazo]").focus()});$.MMS.validateForm("#frmAprobacionModificacionObjetivo")},undoSendForModificationApproval:function(){var n=this;swal({title:"Undo Send for Modification Approval",text:"The Objectives will be able to modify them.",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0},function(){$.post("/api/Peak/CancelarAprobacionModificacionObjetivos/"+n.peak.Id).done(function(t){t?(n.peak.Estado=t.Estado,msgSuccess("Undo done.")):msgError("Error undoing the action.")}).fail(handleError).always(function(){swal.close()})})},sendForModificationApproval:function(){var n=this,t=0;for(var i in n.objetivos)n.objetivos[i].Estado==4&&t++;if(!t){msgAlert("At least one objective must be modified.");return}swal({title:"Send for Modification Approval",text:"The Modified Objectives will be send for approval.<br>After this action you will not be able to modify them.",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonText:"Send"},function(){$.post("/api/Peak/EnvioAprobacionModificacionObjetivos/"+n.peak.Id).done(function(t){t?(n.peak.Estado=t.Estado,msgSuccess("The Objectives were sent for modification approval.")):msgError("Error sending Objectives for modification approval.")}).fail(handleError).always(function(){swal.close()})})},modalModificacionObjetivo:function(n){var t=this;t.objetivo=jQuery.extend(!0,{},t.objetivos[n]);t.modificacion.motivoModificacion=t.objetivo.MotivoModificacion;t.modal("#frmModificacionObjetivo .modal",function(){$("#frmModificacionObjetivo").find("[name=Objetivo]").focus()});$.MMS.validateForm("#frmModificacionObjetivo")},submitModificacionObjetivo:function(n){if($(n.target).valid()){var t=this;sLoading();$.post("/api/Peak/ModificacionObjetivo/",$(n.target).serialize()).done(function(n){if(n){var i=t.objetivo.Numero-1;t.objetivos[i].FechaMeta=t.objetivo.FechaMeta;t.objetivos[i].Objetivo=t.objetivo.Objetivo;t.objetivos[i].MedidoPor=t.objetivo.MedidoPor;t.objetivos[i].Estado=n.Estado;t.objetivos[i].MotivoModificacion=t.modificacion.motivoModificacion;t.objetivos[i].SolicitudEliminacionHeredado=t.objetivo.SolicitudEliminacionHeredado;msgSuccess("Objective Saved.");$("#frmModificacionObjetivo .modal").modal("hide")}else msgError("Error saving Objective.")}).fail(handleError).always(hLoading)}},modalAvance:function(n){var t=this;t.objetivo=jQuery.extend(!0,{},t.objetivos[n]);t.avance.resultadosActuales=t.objetivo.ResultadosActuales;t.avance.comentarios=t.objetivo.Comentarios;t.modal("#frmAvance .modal",function(){if(t.avance.completado=t.objetivo.Completado,r)r.noUiSlider.set(t.avance.completado);else{r=$("#nouislider_completado")[0];noUiSlider.create(r,{start:[t.avance.completado],connect:"lower",step:1,range:{min:[0],max:[100]}});r.noUiSlider.on("update",function(){var n=r.noUiSlider.get();t.avance.completado=parseInt(n)})}$("#frmAvance").find("[name=ResultadosActuales]").focus()});$.MMS.validateForm("#frmAvance")},submitAvance:function(n){if($(n.target).valid()){var t=this;sLoading();$.post("/api/Peak/Avance/",$(n.target).serialize()).done(function(n){if(n){var i=t.objetivo.Numero-1;t.objetivos[i].Completado=t.avance.completado;t.objetivos[i].ResultadosActuales=t.avance.resultadosActuales;t.objetivos[i].Comentarios=t.avance.comentarios;t.recalcularCompletado();msgSuccess("Objective Saved.");$("#frmAvance .modal").modal("hide")}else msgError("Error saving Objective.")}).fail(handleError).always(hLoading)}},sendApprovalResults:function(){var n=this,t=0;for(var i in n.objetivos)n.objetivos[i].Estado!=1&&t++;if(t!=n.numeroObjetivos){msgAlert("All Objectives must be Approved or Disapproved.");return}swal({title:"Send Approval Results",text:"The Approval Results will be send to the Associate",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonText:"Send"},function(){$.post("/api/Peak/EnvioResultadosAprobacion/"+n.peak.Id).done(function(t){t?(n.peak.Estado=t.Estado,msgSuccess("The Approval Results were sent.")):msgError("Error sending The Approval Results.")}).fail(handleError).always(function(){swal.close()})})},modalAprobacionObjetivo:function(n){var t=this;t.objetivo=jQuery.extend(!0,{},t.objetivos[n]);t.aprobacion.estado=t.objetivo.Estado;t.aprobacion.comentariosRechazo=t.objetivo.ComentariosRechazo;t.modal("#frmAprobacionObjetivo .modal",function(){$("#frmAprobacionObjetivo").find("[name=ComentariosRechazo]").focus()});$.MMS.validateForm("#frmAprobacionObjetivo")},submitAprobacionObjetivo:function(n){if($(n.target).valid()){var t=this;sLoading();$.post("/api/Peak/AprobacionObjetivo/",$(n.target).serialize()).done(function(i){if(i){var r=t.objetivo.Numero-1;t.objetivos[r].Estado=i.Estado;t.objetivos[r].ComentariosRechazo=i.Estado==3?t.aprobacion.comentariosRechazo:null;msgSuccess("Objective Saved.");$(n.target).find(".modal").modal("hide")}else msgError("Error saving Objective.")}).fail(handleError).always(hLoading)}},sendForApproval:function(){var n=this,t=0;for(var i in n.objetivos)t+=parseInt(n.objetivos[i].Peso);if(t!=100){msgAlert("The sum of the Weights must be 100%");return}swal({title:"Send for Approval",text:"The Objectives will be send for approval.<br>After this action you will not be able to modify them.",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonText:"Send"},function(){$.post("/api/Peak/EnvioAprobacionObjetivos/"+n.peak.Id).done(function(t){t?(n.peak.Estado=t.Estado,msgSuccess("The Objectives were sent for approval.")):msgError("Error sending Objectives for approval.")}).fail(handleError).always(function(){swal.close()})})},undoSendForApproval:function(){var n=this;swal({title:"Undo Send for Approval",text:"The Objectives will be able to modify them.",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0},function(){$.post("/api/Peak/CancelarAprobacionObjetivos/"+n.peak.Id).done(function(t){t?(n.peak.Estado=t.Estado,msgSuccess("Undo done.")):msgError("Error undoing the action.")}).fail(handleError).always(function(){swal.close()})})},eliminarObjetivo:function(n){var t=this;swal({title:"Delete Objective",text:"Are you sure you want to delete this Objective?",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#f44336",confirmButtonText:"Delete"},function(){$.post("/api/Peak/EliminarObjetivo/"+t.objetivos[n].Id).done(function(i){if(i){t.objetivos.splice(n,1);for(var r=n;r<t.objetivos.length;r++)t.objetivos[r].Numero--;msgSuccess("Objective deleted.")}else msgError("Error deleting Objective.")}).fail(handleError).always(function(){swal.close()})})},modalObjetivo:function(n){var t=this;n==-1?(t.objetivo.Id=0,t.objetivo.Numero=t.objetivos.length+1,t.objetivo.Peso="",t.objetivo.Heredable=!1,t.objetivo.Objetivo="",t.objetivo.FechaMeta="",t.objetivo.MedidoPor="",t.objetivo.Estado=0,t.objetivo.PeakObjetivoId=null):t.objetivo=jQuery.extend(!0,{},t.objetivos[n]);t.modal("#frmObjetivo .modal",function(){$("#frmObjetivo").find("[name=Peso]").focus()});$.MMS.validateForm("#frmObjetivo")},submitObjetivo:function(n){if($(n.target).valid()){var t=this,i=function(){sLoading();$.post("/api/Peak/Objetivo/",$(n.target).serialize()).done(function(n){if(n){if(t.objetivo.Id==0){var i=jQuery.extend(!0,{},t.objetivo);i.Id=n.Id;i.Estado=n.Estado;t.objetivos.push(i)}else t.objetivos.splice(t.objetivo.Numero-1,1,jQuery.extend(!0,{},t.objetivo)),t.objetivos[t.objetivo.Numero-1].Estado=n.Estado;msgSuccess("Objective Saved.");$("#frmObjetivo .modal").modal("hide")}else msgError("Error saving Objective.")}).fail(handleError).always(hLoading)};t.objetivo.Estado==2?swal({title:"Objective Approved",text:"This Objective is approved. If you modify it, the approval will be lost.",type:"warning",html:!0,showCancelButton:!0},i):i()}},modalConfirmacion:function(){var n=this;n.confirmacion.areaId=n.usuario.Area?n.usuario.Area.Id:null;n.confirmacion.cargo=n.usuario.Cargo;n.confirmacion.usuarioPadre=n.usuario.UsuarioPadre?{id:n.usuario.UsuarioPadre.Id,nombre:n.usuario.UsuarioPadre.Nombre}:null;n.modal("#frmConfirmacion .modal");$.MMS.validateForm("#frmConfirmacion")},submitConfirmacion:function(n){if($(n.target).valid()){var t=this;sLoading();$.post("/api/Peak/Confirmacion/",$(n.target).serialize()).done(function(n){n?(t.peak.Id=n.Id,t.peak.Estado=n.Estado,t.usuario.Area=n.Area,t.usuario.Cargo=t.confirmacion.cargo,msgSuccess("Associate's Information Saved."),$("#frmConfirmacion .modal").modal("hide")):msgError("Error saving Associate's Information.")}).fail(handleError).always(hLoading)}},asignarObjetivos:function(n){for(var t in n)n[t].FechaMeta=moment(n[t].FechaMeta).format("YYYY-MM-DD"),n[t].Completado==null&&(n[t].Completado=0);this.objetivos=n},getSkillName:function(n){var t,i;if(!n)return"";t=this;for(i in t.skills)if(t.skills[i].Value==n)return t.skills[i].Name;return""},recalcularCompletado:function(){var n=this,t=0;for(var i in n.objetivos)t+=n.objetivos[i].Completado;n.completado=Math.round(t/n.numeroObjetivos)},recalcularCalificacion:function(){var n=this,t=0;for(var i in n.objetivos)t+=n.objetivos[i].Factor==null?0:n.objetivos[i].Factor;n.calificacion=t+n.peak.FactorAjuste},modal:function(n,t){$(n).one("shown.bs.modal",function(){$.AdminBSB.input.activate(n);$.AdminBSB.select.activate(n);updateMaterialTextFields(n);t&&t()}).modal()},replaceIntro:function(n){return n?n.replaceAll("\n","<br>"):""},tabSelected:function(n,t){this.tabId=n;n==2&&(this.revisionSeleccionada=this.revisiones[t])}}})};