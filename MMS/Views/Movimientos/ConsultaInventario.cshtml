

@{
    string controllerName = ViewContext.RouteData.Values["controller"].ToString();
    ViewBag.Title = "Consulta de Inventario";
    Layout = "~/Views/Shared/_LayoutTT.cshtml";
}

@section Styles
{
    @Styles.Render("~/bundles/cssDataTables")
}

@section Scripts
{
    @Scripts.Render("~/bundles/jsDataTables")
    <script type="text/javascript" src="~/Scripts/jquery.number/jquery.number.js"></script>
    @*<script src="~/Scripts/Transacciones/ConsultaInventario.js" type="text/javascript"></script>*@

    <script type="text/javascript">
        $(document).ready(function () {
            $('[data-toggle="tooltip"]').tooltip();

            dt = dataTablesIndex("tableInventario", "/api/ConsultaInventarioApi/filldata", "/@controllerName/ConsultaInventario",
                [
                    { data: "MovimientoId" },
                    { data: "MovimientoLinea" },
                    { data: "ProductoId" },
                    { data: "ProductoDesc" },
                    {
                        data: "MovimientoFechaCrea",
                        render: function (data) {
                            var fecha = new Date(data.replace("-", "/").substring(0, 10));
                            var day = (fecha.getDate().toString().length == 1) ? '0' + fecha.getDate().toString() : fecha.getDate().toString();
                            var mes = fecha.getMonth() + 1;
                            var mes = (mes.toString().length == 1) ? '0' + mes.toString() : mes;
                            var data = day + '/' + mes + '/' + fecha.getFullYear();
                            return '<span>' + data + '</span>';
                        }
                    },
                    {
                        data: "MovimientoValor",
                        render: function (data) {
                            return '<div class="text-right"><span class="movValor">' + data + '</span><div>';
                        }
                    },
                    {
                        data: "MovimientoCantidad",
                        render: function (data) {
                            return '<div class="text-right">' + data + '<div>';
                        }
                    },
                    {
                        data: "MovimientoDisponible",
                        render: function (data) {
                            return '<div class="text-right">' + data + '<div>';
                        }
                    },
                    {
                        data: "MovimientoReservado",
                        render: function (data) {
                            return '<div class="text-right">' + data + '<div>';
                        }
                    },
                    {
                        data: "MovimientoId",
                        render: function (data, npi, row) {
                            return `<a href='javascript:void(0)' onclick="promptDetalleSalidas(${data}, ${row.MovimientoLinea})" class='btn-table btn-info btn-sm btn-sm-circle waves-circle waves-effect waves-float' data-toggle="tooltip" data-placement="top" title="Ver detalle de salidas"><i class='material-icons'>list</i></a>`;
                        }
                    }
                ]);

            dt.on('draw.dt', function () {
                $(".movValor").number(true, 0, ',', '.');
            });
        });

        function promptDetalleSalidas(MovimientoId, linea) {
            sLoading();
            $.ajax({
                url: '/Movimientos/_DetalleMovimiento',
                data: { MovimientoId: MovimientoId, linea: linea },
                contentType: 'application/html; charset=utf-8',
                type: 'GET',
                dataType: 'html'

            })
            .success(function (result) {
                $('#consuInvModal').html(result);
            })
            .error(function (xhr, status) {
                alert(xhr.responseText);
            })
            .complete(function (xhr, status) {
                hLoading();
                if (status == "success") {
                    $('#_Modal').modal();
                }
            });
        }
    </script>
}

@*<script type="text/javascript">
        var estados = @Html.Raw(Json.Encode(@ViewBag.EstadoOrden));
        var rolid = @Html.Raw(Json.Encode(@ViewBag.rolid));
    </script>*@

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="header bg-blue">
                <h2>
                    @ViewBag.Title <small>@ViewBag.Subtitle</small>
                </h2>
            </div>
            <div class="body">
                <table id="tableInventario" class="table table-bordered table-striped table-hover dataTable table-condensed table-va-middle nowrap" width="100%">
                    <thead>
                        <tr>
                            <th>Mov</th>
                            <th>Lin</th>
                            <th>Producto</th>
                            <th>Nombre</th>
                            <th>Fecha</th>
                            <th class="text-right">Valor</th>
                            <th class="text-right">Cant.</th>
                            <th class="text-right">Disp.</th>
                            <th class="text-right">Res.</th>
                            <th class="all"></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div id="consuInvModal"></div>